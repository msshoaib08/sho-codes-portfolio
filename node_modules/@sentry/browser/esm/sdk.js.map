{"version":3,"file":"sdk.js","sources":["../../../src/sdk.ts"],"sourcesContent":["import { getCurrentScope } from '@sentry/core';\nimport { functionToStringIntegration, inboundFiltersIntegration } from '@sentry/core';\nimport {\n  captureSession,\n  getClient,\n  getIntegrationsToSetup,\n  getReportDialogEndpoint,\n  initAndBind,\n  lastEventId,\n  startSession,\n} from '@sentry/core';\nimport type { DsnLike, Integration, Options, UserFeedback } from '@sentry/types';\nimport { consoleSandbox, logger, stackParserFromStackParserOptions, supportsFetch } from '@sentry/utils';\n\nimport { addHistoryInstrumentationHandler } from '@sentry-internal/browser-utils';\nimport { dedupeIntegration } from '@sentry/core';\nimport type { BrowserClientOptions, BrowserOptions } from './client';\nimport { BrowserClient } from './client';\nimport { DEBUG_BUILD } from './debug-build';\nimport { WINDOW } from './helpers';\nimport { breadcrumbsIntegration } from './integrations/breadcrumbs';\nimport { browserApiErrorsIntegration } from './integrations/browserapierrors';\nimport { globalHandlersIntegration } from './integrations/globalhandlers';\nimport { httpContextIntegration } from './integrations/httpcontext';\nimport { linkedErrorsIntegration } from './integrations/linkederrors';\nimport { defaultStackParser } from './stack-parsers';\nimport { makeFetchTransport } from './transports/fetch';\n\n/** Get the default integrations for the browser SDK. */\nexport function getDefaultIntegrations(_options: Options): Integration[] {\n  /**\n   * Note: Please make sure this stays in sync with Angular SDK, which re-exports\n   * `getDefaultIntegrations` but with an adjusted set of integrations.\n   */\n  return [\n    inboundFiltersIntegration(),\n    functionToStringIntegration(),\n    browserApiErrorsIntegration(),\n    breadcrumbsIntegration(),\n    globalHandlersIntegration(),\n    linkedErrorsIntegration(),\n    dedupeIntegration(),\n    httpContextIntegration(),\n  ];\n}\n\nfunction applyDefaultOptions(optionsArg: BrowserOptions = {}): BrowserOptions {\n  const defaultOptions: BrowserOptions = {\n    defaultIntegrations: getDefaultIntegrations(optionsArg),\n    release:\n      typeof __SENTRY_RELEASE__ === 'string' // This allows build tooling to find-and-replace __SENTRY_RELEASE__ to inject a release value\n        ? __SENTRY_RELEASE__\n        : WINDOW.SENTRY_RELEASE && WINDOW.SENTRY_RELEASE.id // This supports the variable that sentry-webpack-plugin injects\n          ? WINDOW.SENTRY_RELEASE.id\n          : undefined,\n    autoSessionTracking: true,\n    sendClientReports: true,\n  };\n\n  return { ...defaultOptions, ...optionsArg };\n}\n\nfunction shouldShowBrowserExtensionError(): boolean {\n  const windowWithMaybeChrome = WINDOW as typeof WINDOW & { chrome?: { runtime?: { id?: string } } };\n  const isInsideChromeExtension =\n    windowWithMaybeChrome &&\n    windowWithMaybeChrome.chrome &&\n    windowWithMaybeChrome.chrome.runtime &&\n    windowWithMaybeChrome.chrome.runtime.id;\n\n  const windowWithMaybeBrowser = WINDOW as typeof WINDOW & { browser?: { runtime?: { id?: string } } };\n  const isInsideBrowserExtension =\n    windowWithMaybeBrowser &&\n    windowWithMaybeBrowser.browser &&\n    windowWithMaybeBrowser.browser.runtime &&\n    windowWithMaybeBrowser.browser.runtime.id;\n\n  return !!isInsideBrowserExtension || !!isInsideChromeExtension;\n}\n\n/**\n * A magic string that build tooling can leverage in order to inject a release value into the SDK.\n */\ndeclare const __SENTRY_RELEASE__: string | undefined;\n\n/**\n * The Sentry Browser SDK Client.\n *\n * To use this SDK, call the {@link init} function as early as possible when\n * loading the web page. To set context information or send manual events, use\n * the provided methods.\n *\n * @example\n *\n * ```\n *\n * import { init } from '@sentry/browser';\n *\n * init({\n *   dsn: '__DSN__',\n *   // ...\n * });\n * ```\n *\n * @example\n * ```\n *\n * import { addBreadcrumb } from '@sentry/browser';\n * addBreadcrumb({\n *   message: 'My Breadcrumb',\n *   // ...\n * });\n * ```\n *\n * @example\n *\n * ```\n *\n * import * as Sentry from '@sentry/browser';\n * Sentry.captureMessage('Hello, world!');\n * Sentry.captureException(new Error('Good bye'));\n * Sentry.captureEvent({\n *   message: 'Manual',\n *   stacktrace: [\n *     // ...\n *   ],\n * });\n * ```\n *\n * @see {@link BrowserOptions} for documentation on configuration options.\n */\nexport function init(browserOptions: BrowserOptions = {}): void {\n  const options = applyDefaultOptions(browserOptions);\n\n  if (shouldShowBrowserExtensionError()) {\n    consoleSandbox(() => {\n      // eslint-disable-next-line no-console\n      console.error(\n        '[Sentry] You cannot run Sentry this way in a browser extension, check: https://docs.sentry.io/platforms/javascript/best-practices/browser-extensions/',\n      );\n    });\n    return;\n  }\n\n  if (DEBUG_BUILD) {\n    if (!supportsFetch()) {\n      logger.warn(\n        'No Fetch API detected. The Sentry SDK requires a Fetch API compatible environment to send events. Please add a Fetch API polyfill.',\n      );\n    }\n  }\n  const clientOptions: BrowserClientOptions = {\n    ...options,\n    stackParser: stackParserFromStackParserOptions(options.stackParser || defaultStackParser),\n    integrations: getIntegrationsToSetup(options),\n    transport: options.transport || makeFetchTransport,\n  };\n\n  initAndBind(BrowserClient, clientOptions);\n\n  if (options.autoSessionTracking) {\n    startSessionTracking();\n  }\n}\n\n/**\n * All properties the report dialog supports\n */\nexport interface ReportDialogOptions {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any;\n  eventId?: string;\n  dsn?: DsnLike;\n  user?: {\n    email?: string;\n    name?: string;\n  };\n  lang?: string;\n  title?: string;\n  subtitle?: string;\n  subtitle2?: string;\n  labelName?: string;\n  labelEmail?: string;\n  labelComments?: string;\n  labelClose?: string;\n  labelSubmit?: string;\n  errorGeneric?: string;\n  errorFormEntry?: string;\n  successMessage?: string;\n  /** Callback after reportDialog showed up */\n  onLoad?(this: void): void;\n  /** Callback after reportDialog closed */\n  onClose?(this: void): void;\n}\n\n/**\n * Present the user with a report dialog.\n *\n * @param options Everything is optional, we try to fetch all info need from the global scope.\n */\nexport function showReportDialog(options: ReportDialogOptions = {}): void {\n  // doesn't work without a document (React Native)\n  if (!WINDOW.document) {\n    DEBUG_BUILD && logger.error('Global document not defined in showReportDialog call');\n    return;\n  }\n\n  const scope = getCurrentScope();\n  const client = scope.getClient();\n  const dsn = client && client.getDsn();\n\n  if (!dsn) {\n    DEBUG_BUILD && logger.error('DSN not configured for showReportDialog call');\n    return;\n  }\n\n  if (scope) {\n    options.user = {\n      ...scope.getUser(),\n      ...options.user,\n    };\n  }\n\n  if (!options.eventId) {\n    const eventId = lastEventId();\n    if (eventId) {\n      options.eventId = eventId;\n    }\n  }\n\n  const script = WINDOW.document.createElement('script');\n  script.async = true;\n  script.crossOrigin = 'anonymous';\n  script.src = getReportDialogEndpoint(dsn, options);\n\n  if (options.onLoad) {\n    script.onload = options.onLoad;\n  }\n\n  const { onClose } = options;\n  if (onClose) {\n    const reportDialogClosedMessageHandler = (event: MessageEvent): void => {\n      if (event.data === '__sentry_reportdialog_closed__') {\n        try {\n          onClose();\n        } finally {\n          WINDOW.removeEventListener('message', reportDialogClosedMessageHandler);\n        }\n      }\n    };\n    WINDOW.addEventListener('message', reportDialogClosedMessageHandler);\n  }\n\n  const injectionPoint = WINDOW.document.head || WINDOW.document.body;\n  if (injectionPoint) {\n    injectionPoint.appendChild(script);\n  } else {\n    DEBUG_BUILD && logger.error('Not injecting report dialog. No injection point found in HTML');\n  }\n}\n\n/**\n * This function is here to be API compatible with the loader.\n * @hidden\n */\nexport function forceLoad(): void {\n  // Noop\n}\n\n/**\n * This function is here to be API compatible with the loader.\n * @hidden\n */\nexport function onLoad(callback: () => void): void {\n  callback();\n}\n\n/**\n * Enable automatic Session Tracking for the initial page load.\n */\nfunction startSessionTracking(): void {\n  if (typeof WINDOW.document === 'undefined') {\n    DEBUG_BUILD && logger.warn('Session tracking in non-browser environment with @sentry/browser is not supported.');\n    return;\n  }\n\n  // The session duration for browser sessions does not track a meaningful\n  // concept that can be used as a metric.\n  // Automatically captured sessions are akin to page views, and thus we\n  // discard their duration.\n  startSession({ ignoreDuration: true });\n  captureSession();\n\n  // We want to create a session for every navigation as well\n  addHistoryInstrumentationHandler(({ from, to }) => {\n    // Don't create an additional session for the initial route or if the location did not change\n    if (from !== undefined && from !== to) {\n      startSession({ ignoreDuration: true });\n      captureSession();\n    }\n  });\n}\n\n/**\n * Captures user feedback and sends it to Sentry.\n *\n * @deprecated Use `captureFeedback` instead.\n */\nexport function captureUserFeedback(feedback: UserFeedback): void {\n  const client = getClient<BrowserClient>();\n  if (client) {\n    // eslint-disable-next-line deprecation/deprecation\n    client.captureUserFeedback(feedback);\n  }\n}\n"],"names":[],"mappings":"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"}