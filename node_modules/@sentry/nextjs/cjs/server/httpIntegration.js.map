{"version":3,"file":"httpIntegration.js","sources":["../../../src/server/httpIntegration.ts"],"sourcesContent":["import { HttpInstrumentation } from '@opentelemetry/instrumentation-http';\nimport { httpIntegration as originalHttpIntegration } from '@sentry/node';\nimport type { IntegrationFn } from '@sentry/types';\n\n/**\n * Next.js handles incoming requests itself,\n * but it does not handle outgoing requests.\n * Today, it is not possible to use the HttpInstrumentation for only outgoing requests -\n * until https://github.com/open-telemetry/opentelemetry-js/pull/4643 is merged & released.\n * So in the meanwhile, we extend the base HttpInstrumentation to not wrap incoming requests.\n */\nclass CustomNextjsHttpIntegration extends HttpInstrumentation {\n  // Instead of the default behavior, we just don't do any wrapping for incoming requests\n  protected _getPatchIncomingRequestFunction(_component: 'http' | 'https') {\n    return (\n      original: (event: string, ...args: unknown[]) => boolean,\n    ): ((this: unknown, event: string, ...args: unknown[]) => boolean) => {\n      return function incomingRequest(this: unknown, event: string, ...args: unknown[]): boolean {\n        return original.apply(this, [event, ...args]);\n      };\n    };\n  }\n}\n\ninterface HttpOptions {\n  /**\n   * Whether breadcrumbs should be recorded for requests.\n   * Defaults to true\n   */\n  breadcrumbs?: boolean;\n\n  /**\n   * Do not capture spans or breadcrumbs for outgoing HTTP requests to URLs where the given callback returns `true`.\n   * This controls both span & breadcrumb creation - spans will be non recording if tracing is disabled.\n   */\n  ignoreOutgoingRequests?: (url: string) => boolean;\n}\n\n/**\n * The http integration instruments Node's internal http and https modules.\n * It creates breadcrumbs and spans for outgoing HTTP requests which will be attached to the currently active span.\n */\nexport const httpIntegration = ((options: HttpOptions = {}) => {\n  return originalHttpIntegration({\n    ...options,\n    _instrumentation: CustomNextjsHttpIntegration,\n  });\n}) satisfies IntegrationFn;\n"],"names":["HttpInstrumentation","originalHttpIntegration"],"mappings":";;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,2BAAA,SAAoCA,uCAAoB,CAAA;AAC9D;AACA,GAAY,gCAAgC,CAAC,UAAU,EAAoB;AAC3E,IAAI,OAAO;AACX,MAAM,QAAQ;AACd,SAA0E;AAC1E,MAAM,OAAO,SAAS,eAAe,EAAgB,KAAK,EAAU,GAAG,IAAI,EAAsB;AACjG,QAAQ,OAAO,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,GAAG,IAAI,CAAC,CAAC,CAAA;AACrD,OAAO,CAAA;AACP,KAAK,CAAA;AACL,GAAE;AACF,CAAA;;AAgBA;AACA;AACA;AACA;AACO,MAAM,eAAgB,IAAG,CAAC,OAAO,GAAgB,EAAE,KAAK;AAC/D,EAAE,OAAOC,oBAAuB,CAAC;AACjC,IAAI,GAAG,OAAO;AACd,IAAI,gBAAgB,EAAE,2BAA2B;AACjD,GAAG,CAAC,CAAA;AACJ,CAAC,CAAE;;;;"}